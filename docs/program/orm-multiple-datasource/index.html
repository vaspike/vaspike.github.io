<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Mybatis &amp; Spring Data Jpa 多数据源配置 - RiverMao</title>
    <meta property="og:title" content="Mybatis &amp; Spring Data Jpa 多数据源配置 - RiverMao">
    
    <meta name="twitter:card" content="summary">

    
      
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/lxgwwenkaiscreen.css" media="print" onload="this.media='all'">

    
      
      <meta property="description" content="package com.xxx.xxx.kotlin.config.hikari.mybatis import com.xxx.xxx.config.hikari.map.specific.MasterMyHikariSetting import com.xxx.xxx.util.HikariSetting2ConfigUtils import &amp;hellip;">
      <meta property="og:description" content="package com.xxx.xxx.kotlin.config.hikari.mybatis import com.xxx.xxx.config.hikari.map.specific.MasterMyHikariSetting import com.xxx.xxx.util.HikariSetting2ConfigUtils import &amp;hellip;">
      
    

    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/nord.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
<script>hljs.configure({
    ignoreUnescapedHTML: true
});</script>

    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <script type="text/javascript" src="/js/codeBlock.js"></script>
    <link rel="shortcut icon" href="/img/favicon.ico"/>
  </head>

  
  <body class="program">
    <header class="masthead">
      <h1><a href="/">RiverMao</a></h1>

<p class="tagline">从未来再见</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/program/">program</a></li>
  
  <li><a href="/life/">life</a></li>
  
  <li><a href="/about">about</a></li>
  
  <li><a href="/index.xml">rss</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Mybatis &amp; Spring Data Jpa 多数据源配置</h1>


<h3>





2024-09-13
</h3>

<hr>


      </header>





<h2 id="mybatis多数据源">Mybatis多数据源</h2>
<ul>
<li>Master:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">package</span> com.xxx.xxx.kotlin.config.hikari.mybatis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.config.hikari.map.specific.MasterMyHikariSetting
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.util.HikariSetting2ConfigUtils
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.zaxxer.hikari.HikariDataSource
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.apache.ibatis.session.SqlSessionFactory
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.mybatis.spring.SqlSessionFactoryBean
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.mybatis.spring.SqlSessionTemplate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.mybatis.spring.annotation.MapperScan
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.slf4j.Logger
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.slf4j.LoggerFactory
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.beans.factory.annotation.Qualifier
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Bean
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Configuration
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Primary
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> javax.sql.DataSource
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Master数据源加载
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author: River
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @version: 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//扫receive包
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">@MapperScan</span>(basePackages = [<span style="color:#e6db74">&#34;com.xxx.xxx.mapper.master&#34;</span>], sqlSessionFactoryRef = <span style="color:#e6db74">&#34;masterSqlSessionFactory&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MasterDatasourceConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//获取日志对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> log: Logger = <span style="color:#a6e22e">LoggerFactory</span>.getLogger(<span style="color:#66d9ef">this</span>.javaClass)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//初始化第一个数据源(master/接收方)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;materDatasource&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Primary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">masterDatasource</span>(myHikariSetting: MasterMyHikariSetting): DataSource {
</span></span><span style="display:flex;"><span>        log.info(<span style="color:#e6db74">&#34;正在初始化Master数据源...&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> HikariDataSource(HikariSetting2ConfigUtils.mySetting2Config(myHikariSetting))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * mybatis sqlSession
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;masterSqlSessionFactory&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Primary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">sqlSessionFactory</span>(<span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;materDatasource&#34;</span>) dataSource: DataSource): SqlSessionFactory? {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> sqlBean = SqlSessionFactoryBean()
</span></span><span style="display:flex;"><span>        sqlBean.setDataSource(dataSource)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//        val resolver = PathMatchingResourcePatternResolver()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//        sqlBean.setMapperLocations(*resolver.getResources(&#34;classpath:mapper/*.xml&#34;))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> sqlBean.`object`
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;masterTransactionManager&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Primary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">transactionManager</span>(<span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;materDatasource&#34;</span>) dataSource: DataSource): DataSourceTransactionManager {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> DataSourceTransactionManager(dataSource)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Primary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;masterSqlSessionTemplate&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">sqlSessionTemplate</span>(<span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;masterSqlSessionFactory&#34;</span>) sqlSessionFactory: SqlSessionFactory): SqlSessionTemplate {
</span></span><span style="display:flex;"><span>        log.info(<span style="color:#e6db74">&#34;Master数据源SqlSessionFactory创建成功...&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> SqlSessionTemplate(sqlSessionFactory)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Next:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">package</span> com.xxx.xxx.kotlin.config.hikari.mybatis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.kotlin.config.hikari.map.specific.SourceFirstMyHikariSetting
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.kotlin.util.HikariSetting2ConfigUtils
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.zaxxer.hikari.HikariDataSource
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.apache.ibatis.session.SqlSessionFactory
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.mybatis.spring.SqlSessionFactoryBean
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.mybatis.spring.SqlSessionTemplate
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.mybatis.spring.annotation.MapperScan
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.slf4j.Logger
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.slf4j.LoggerFactory
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.beans.factory.annotation.Qualifier
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Bean
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Configuration
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> javax.sql.DataSource
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 第一个副数据源加载
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author River
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @since 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@MapperScan</span>(basePackages = [<span style="color:#e6db74">&#34;com.xxx.xxx.mapper.first&#34;</span>], sqlSessionFactoryRef = <span style="color:#e6db74">&#34;sourceFirstSqlSessionFactory&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SourceFirstDatasourceConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//获取日志对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> log: Logger = <span style="color:#a6e22e">LoggerFactory</span>.getLogger(<span style="color:#66d9ef">this</span>.javaClass)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;sourceFirstDatasource&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">sourceFirstDatasource</span>(myHikariSetting: SourceFirstMyHikariSetting): DataSource {
</span></span><span style="display:flex;"><span>        log.info(<span style="color:#e6db74">&#34;正在初始化第一个副数据源...&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> HikariDataSource(HikariSetting2ConfigUtils.mySetting2Config(myHikariSetting))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * mybatis sqlSession
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;sourceFirstSqlSessionFactory&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">sqlSessionFactory</span>(<span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;sourceFirstDatasource&#34;</span>) dataSource: DataSource): SqlSessionFactory? {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> sqlBean = SqlSessionFactoryBean()
</span></span><span style="display:flex;"><span>        sqlBean.setDataSource(dataSource)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//        val resolver = PathMatchingResourcePatternResolver()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//        sqlBean.setMapperLocations(*resolver.getResources(&#34;classpath:mapper/*.xml&#34;))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> sqlBean.`object`
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;sourceFirstTransactionManager&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">transactionManager</span>(<span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;sourceFirstDatasource&#34;</span>) dataSource: DataSource): DataSourceTransactionManager {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> DataSourceTransactionManager(dataSource)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;sourceFirstSqlSessionTemplate&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">sqlSessionTemplate</span>(<span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;sourceFirstSqlSessionFactory&#34;</span>) sqlSessionFactory: SqlSessionFactory): SqlSessionTemplate {
</span></span><span style="display:flex;"><span>        log.info(<span style="color:#e6db74">&#34;第一个副数据源SqlSessionFactory创建成功...&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> SqlSessionTemplate(sqlSessionFactory)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="spring-data-jpa-多数据源">Spring Data Jpa 多数据源</h2>
<ul>
<li>Primary:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">package</span> com.xxx.xxx.kotlin.config.hikari.jpa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.kotlin.config.hikari.map.specific.MasterMyHikariSetting
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.kotlin.util.HikariSetting2ConfigUtils
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.zaxxer.hikari.HikariDataSource
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.slf4j.Logger
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.slf4j.LoggerFactory
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.beans.factory.annotation.Autowired
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.beans.factory.annotation.Qualifier
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.boot.autoconfigure.orm.jpa.HibernateProperties
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.boot.autoconfigure.orm.jpa.HibernateSettings
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.boot.autoconfigure.orm.jpa.JpaProperties
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.boot.orm.jpa.EntityManagerFactoryBuilder
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Bean
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Configuration
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Primary
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.orm.jpa.JpaTransactionManager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.orm.jpa.persistenceunit.PersistenceUnitManager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.orm.jpa.vendor.AbstractJpaVendorAdapter
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.transaction.PlatformTransactionManager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.transaction.annotation.EnableTransactionManagement
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> javax.persistence.EntityManager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> javax.sql.DataSource
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableTransactionManagement</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableJpaRepositories</span>(
</span></span><span style="display:flex;"><span>    entityManagerFactoryRef = <span style="color:#e6db74">&#34;entityManagerFactoryPrimary&#34;</span>,
</span></span><span style="display:flex;"><span>    transactionManagerRef = <span style="color:#e6db74">&#34;transactionManagerPrimary&#34;</span>,
</span></span><span style="display:flex;"><span>    basePackages = [<span style="color:#e6db74">&#34;com.xxx.xxx.kotlin.repository.first&#34;</span>]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PrimaryDatasourceConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//获取日志对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> log: Logger = <span style="color:#a6e22e">LoggerFactory</span>.getLogger(<span style="color:#66d9ef">this</span><span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> jpaProperties: JpaProperties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> hibernateProperties: HibernateProperties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>(required = <span style="color:#66d9ef">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> persistenceUnitManager: PersistenceUnitManager? = <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;primaryDatasource&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">primaryDatasource</span>(myHikariSetting: MasterMyHikariSetting): DataSource {
</span></span><span style="display:flex;"><span>        log.info(<span style="color:#e6db74">&#34;正在初始化JPA master数据源...&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> HikariDataSource(HikariSetting2ConfigUtils.mySetting2Config(myHikariSetting))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">getVendorProperties</span>(): Map&lt;String?, Any?&gt;? {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> hibernateProperties.determineHibernateProperties(jpaProperties.properties, HibernateSettings())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;myEntityManagerFactoryBuilder&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">customerEntityManagerFactoryBuilder</span>(customerJpaProperties: JpaProperties): EntityManagerFactoryBuilder? {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> adapter: AbstractJpaVendorAdapter = HibernateJpaVendorAdapter()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> EntityManagerFactoryBuilder(
</span></span><span style="display:flex;"><span>            adapter,
</span></span><span style="display:flex;"><span>            customerJpaProperties.properties, persistenceUnitManager
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;entityManagerPrimary&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Primary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">entityManager</span>(<span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;myEntityManagerFactoryBuilder&#34;</span>)builder: EntityManagerFactoryBuilder, <span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;primaryDatasource&#34;</span>) datasource: DataSource): EntityManager? {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> entityManagerFactoryPrimary(builder, datasource).getObject()<span style="color:#f92672">!!</span>.createEntityManager()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;entityManagerFactoryPrimary&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Primary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">entityManagerFactoryPrimary</span>(<span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;myEntityManagerFactoryBuilder&#34;</span>)builder: EntityManagerFactoryBuilder, <span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;primaryDatasource&#34;</span>) datasource: DataSource): LocalContainerEntityManagerFactoryBean {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> builder
</span></span><span style="display:flex;"><span>            .dataSource(datasource)
</span></span><span style="display:flex;"><span>            .packages(<span style="color:#e6db74">&#34;com.xxx.xxx.kotlin.entity.master&#34;</span>) <span style="color:#75715e">//设置实体类所在位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .persistenceUnit(<span style="color:#e6db74">&#34;primary&#34;</span>)
</span></span><span style="display:flex;"><span>            .properties(getVendorProperties())
</span></span><span style="display:flex;"><span>            .build()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;transactionManagerPrimary&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Primary</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">transactionManagerPrimary</span>(<span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;myEntityManagerFactoryBuilder&#34;</span>)builder: EntityManagerFactoryBuilder, <span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;primaryDatasource&#34;</span>) datasource: DataSource): PlatformTransactionManager? {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> JpaTransactionManager(entityManagerFactoryPrimary(builder, datasource).getObject()<span style="color:#f92672">!!</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Next:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">package</span> com.xxx.xxx.kotlin.config.hikari.jpa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.kotlin.config.hikari.map.specific.SourceSecondMyHikariSetting
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.kotlin.util.HikariSetting2ConfigUtils
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.zaxxer.hikari.HikariDataSource
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.slf4j.Logger
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.slf4j.LoggerFactory
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.beans.factory.annotation.Autowired
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.beans.factory.annotation.Qualifier
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.boot.autoconfigure.orm.jpa.HibernateProperties
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.boot.autoconfigure.orm.jpa.HibernateSettings
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.boot.autoconfigure.orm.jpa.JpaProperties
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.boot.orm.jpa.EntityManagerFactoryBuilder
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Bean
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Configuration
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.orm.jpa.JpaTransactionManager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.transaction.PlatformTransactionManager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.transaction.annotation.EnableTransactionManagement
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> javax.persistence.EntityManager
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> javax.sql.DataSource
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableTransactionManagement</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableJpaRepositories</span>(
</span></span><span style="display:flex;"><span>    entityManagerFactoryRef = <span style="color:#e6db74">&#34;entityManagerFactorySecondary&#34;</span>,
</span></span><span style="display:flex;"><span>    transactionManagerRef = <span style="color:#e6db74">&#34;transactionManagerSecondary&#34;</span>,
</span></span><span style="display:flex;"><span>    basePackages = [<span style="color:#e6db74">&#34;com.xxx.xxx.kotlin.repository.second&#34;</span>]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecondaryDatasourceConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//获取日志对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> log: Logger = <span style="color:#a6e22e">LoggerFactory</span>.getLogger(<span style="color:#66d9ef">this</span><span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> jpaProperties: JpaProperties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> hibernateProperties: HibernateProperties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;secondaryDatasource&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">secondaryDatasource</span>(myHikariSetting: SourceSecondMyHikariSetting): DataSource {
</span></span><span style="display:flex;"><span>        log.info(<span style="color:#e6db74">&#34;正在初始化JPA Second数据源...&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> HikariDataSource(HikariSetting2ConfigUtils.mySetting2Config(myHikariSetting))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">getVendorProperties</span>(): Map&lt;String?, Any?&gt;? {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> hibernateProperties.determineHibernateProperties(jpaProperties.properties, HibernateSettings())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;entityManagerSecondary&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">entityManager</span>(
</span></span><span style="display:flex;"><span>        builder: EntityManagerFactoryBuilder,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;secondaryDatasource&#34;</span>) datasource: DataSource
</span></span><span style="display:flex;"><span>    ): EntityManager? {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> entityManagerFactorySecondary(builder, datasource).getObject()<span style="color:#f92672">!!</span>.createEntityManager()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;entityManagerFactorySecondary&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">entityManagerFactorySecondary</span>(
</span></span><span style="display:flex;"><span>        builder: EntityManagerFactoryBuilder,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;secondaryDatasource&#34;</span>) datasource: DataSource
</span></span><span style="display:flex;"><span>    ): LocalContainerEntityManagerFactoryBean {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> builder
</span></span><span style="display:flex;"><span>            .dataSource(datasource)
</span></span><span style="display:flex;"><span>            .packages(<span style="color:#e6db74">&#34;com.xxx.xxx.kotlin.entity.second&#34;</span>) <span style="color:#75715e">//设置实体类所在位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .persistenceUnit(<span style="color:#e6db74">&#34;secondary&#34;</span>)
</span></span><span style="display:flex;"><span>            .properties(getVendorProperties())
</span></span><span style="display:flex;"><span>            .build()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>(name = [<span style="color:#e6db74">&#34;transactionManagerSecondary&#34;</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">transactionManagerSecondary</span>(
</span></span><span style="display:flex;"><span>        builder: EntityManagerFactoryBuilder,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@Qualifier</span>(<span style="color:#e6db74">&#34;secondaryDatasource&#34;</span>) datasource: DataSource
</span></span><span style="display:flex;"><span>    ): PlatformTransactionManager? {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> JpaTransactionManager(entityManagerFactorySecondary(builder, datasource).getObject()<span style="color:#f92672">!!</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="工具类与其他实体">工具类与其他实体</h2>
<ul>
<li><code>MasterMyHikariSetting</code> (其他以MyHikariSetting结尾的类与此类似,父类<code>BaseMyHikariSetting</code>属性与此相同):</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">package</span> com.xxx.xxx.kotlin.config.hikari.map.specific
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.kotlin.config.hikari.map.BaseMyHikariSetting
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.kotlin.config.factory.YamlPropertySourceFactory
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.boot.context.properties.ConfigurationProperties
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.Configuration
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> org.springframework.context.annotation.PropertySource
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> java.util.*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * master配置实体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@PropertySource</span>(<span style="color:#66d9ef">value</span> = [<span style="color:#e6db74">&#34;classpath:datasources/datasources.yml&#34;</span>], factory = YamlPropertySourceFactory<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@ConfigurationProperties</span>(prefix = <span style="color:#e6db74">&#34;spring.datasources.master.hikari&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MasterMyHikariSetting</span> : BaseMyHikariSetting(){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">var</span> maximumPoolSize: Int? = <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">var</span> idleTimeout: Long? = <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">var</span> maxLifetime: Long? = <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">var</span> dataSourceProperties: Properties? = <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">var</span> driverClassName: String? = <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">var</span> jdbcUrl: String? = <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">var</span> username: String? = <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">var</span> password: String? = <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><code>HikariSetting2ConfigUtils</code>:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">package</span> com.xxx.xxx.kotlin.util
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.xxx.xxx.kotlin.config.hikari.map.BaseMyHikariSetting
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> com.zaxxer.hikari.HikariConfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Hikari数据源配置工具类
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author River
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @since 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HikariSetting2ConfigUtils</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">companion</span> <span style="color:#66d9ef">object</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * 自定义Hikari配置转换为标准Hikari配置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">mySetting2Config</span>(baseSetting: BaseMyHikariSetting): HikariConfig {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">val</span> hikariConfig = HikariConfig()
</span></span><span style="display:flex;"><span>            hikariConfig.driverClassName = baseSetting.driverClassName
</span></span><span style="display:flex;"><span>            hikariConfig.jdbcUrl = baseSetting.jdbcUrl
</span></span><span style="display:flex;"><span>            hikariConfig.username = baseSetting.username
</span></span><span style="display:flex;"><span>            hikariConfig.password = baseSetting.password
</span></span><span style="display:flex;"><span>            hikariConfig.maximumPoolSize = baseSetting.maximumPoolSize<span style="color:#f92672">!!</span>
</span></span><span style="display:flex;"><span>            hikariConfig.maxLifetime = baseSetting.maxLifetime<span style="color:#f92672">!!</span>
</span></span><span style="display:flex;"><span>            hikariConfig.idleTimeout = baseSetting.idleTimeout<span style="color:#f92672">!!</span>
</span></span><span style="display:flex;"><span>            hikariConfig.dataSourceProperties = baseSetting.dataSourceProperties
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> hikariConfig
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>位于项目<code>resources/datasources</code>目录下的<code>datasources.yml</code>文件:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">datasources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#    主数据源(pg)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">master</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hikari</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">driver-class-name</span>: <span style="color:#ae81ff">org.postgresql.Driver</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">jdbc-url</span>: <span style="color:#ae81ff">jdbc:postgresql://127.0.0.1/xxx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">username</span>: <span style="color:#ae81ff">postgres</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">password</span>: <span style="color:#ae81ff">testpostgres</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">maximum-pool-size</span>: <span style="color:#ae81ff">20</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">max-lifetime</span>: <span style="color:#ae81ff">30000</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">idle-timeout</span>: <span style="color:#ae81ff">30000</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data-source-properties</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">prepStmtCacheSize</span>: <span style="color:#ae81ff">250</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">prepStmtCacheSqlLimit</span>: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cachePrepStmts</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">useServerPrepStmts</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#    access数据源</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">first</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hikari</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">driver-class-name</span>: <span style="color:#ae81ff">net.ucanaccess.jdbc.UcanaccessDriver</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">jdbc-url</span>: <span style="color:#ae81ff">jdbc:ucanaccess:////xxx/xxx/xxx.mdb</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">username</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">password</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">maximum-pool-size</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">max-lifetime</span>: <span style="color:#ae81ff">30000</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">idle-timeout</span>: <span style="color:#ae81ff">30000</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data-source-properties</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">prepStmtCacheSize</span>: <span style="color:#ae81ff">250</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">prepStmtCacheSqlLimit</span>: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cachePrepStmts</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">useServerPrepStmts</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">second</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hikari</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">driver-class-name</span>: <span style="color:#ae81ff">org.postgresql.Driver</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">jdbc-url</span>: <span style="color:#ae81ff">jdbc:postgresql://127.0.0.1:5432/xxx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">username</span>: <span style="color:#ae81ff">postgres</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">password</span>: <span style="color:#ae81ff">postgres</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">maximum-pool-size</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">max-lifetime</span>: <span style="color:#ae81ff">30000</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">idle-timeout</span>: <span style="color:#ae81ff">30000</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">data-source-properties</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">prepStmtCacheSize</span>: <span style="color:#ae81ff">250</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">prepStmtCacheSqlLimit</span>: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cachePrepStmts</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">useServerPrepStmts</span>: <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><h2 id="tip">Tip:</h2>
<p>如果在一个项目中mybatis和spring data jpa同时开启了多数据源,在Spring的事务注解中需指定当前事务管理bean</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Transactional</span>(rollbackFor <span style="color:#f92672">=</span> { Exception.<span style="color:#a6e22e">class</span>, Xxx.<span style="color:#a6e22e">class</span> },transactionManager <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;masterTransactionManager&#34;</span>)
</span></span></code></pre></div>


  <footer>
  
  
  
  <hr>
  <div class="copyright">© <a href="https://rivermao.com">RiverMao</a> | since 2020 | <em>本站文章均为原创,转载请标明出处</em></div>
  
  </footer>
  </article>
  
  </body>
</html>

